# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Описание данных
**Способ оплаты**
`Payment` — Тип для обозначения способа оплаты:
- "card" — Оплата картой.
- "cash" — Оплата наличными.
- null — Способ оплаты не выбран.

**Шаблоны HTML**
`Templates` — Тип, описывающий доступные HTML-шаблоны для различных разделов сайта:
- success: HTMLTemplateElement | null — Шаблон для страницы успешного оформления заказа.
- cardCatalog: HTMLTemplateElement | null — Шаблон карточки товара в каталоге.
- cardPreview: HTMLTemplateElement | null — Шаблон карточки предпросмотра товара.
- cardBasket: HTMLTemplateElement | null — Шаблон карточки товара в корзине.
- basket: HTMLTemplateElement | null — Шаблон страницы корзины.
- order: HTMLTemplateElement | null — Шаблон страницы оформления заказа.
- contacts: HTMLTemplateElement | null — Шаблон страницы с контактами.

**Данные товара**
`IProduct` — Интерфейс, описывающий товар:
- id: string — Уникальный идентификатор товара.
- category: string — Категория товара.
- image: string — URL изображения товара.
- title: string — Название товара.
- description: string — Описание товара.
- price: number — Цена товара.

**Данные заказа**
`IOrder` — Интерфейс, описывающий данные для оформления заказа:
- payment: Payment — Способ оплаты.
- address: string — Адрес доставки.
- email: string — Электронная почта клиента.
- phone: string — Контактный телефон клиента.
- total: number — Общая сумма заказа.
- items: string[] — Список ID товаров в заказе.

**Данные корзины**
`ICart` — Интерфейс, описывающий корзину:
- items: IProduct[] — Список товаров в корзине.
- total: number — Общая сумма товаров в корзине.

**Каталог**
`ICatalog` — Интерфейс, описывающий каталог товаров:
- items: IProduct[] — Список товаров в каталоге.

**Статус заказа**
`IOrderStatus` — Интерфейс, описывающий статус оплаты или оформления заказа:
- total: number — Общая сумма заказа.
- isComplete: boolean — Статус завершения заказа (true — заказ успешно оформлен, false — заказ не завершен).

**Интерфейс API**
`IApi` — Интерфейс для взаимодействия с API:
- baseUrl: string — Базовый URL API.
- get<T>(uri: string): Promise<T> — Метод для отправки GET-запроса:
- post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T> — Метод для отправки POST-запроса:
- getProducts: () => Promise<ApiListResponse<IProduct>> — Метод для получения списка товаров.
- orderProducts(order: IOrder): Promise<IOrderStatus> — Метод для оформления заказа:

## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP:

- слой представления(view), отвечающий за отображение данных,
- слой данных(model), отвечающий за хранение и изменение данных,
- презентер(presenter), отвечающий за связь представления и данных.
## Базовый код

**Класс EventEmitter** 
обеспечивает работу событий c создаёт функцию-коллбэк, которая при вызове генерирует событие с заданным именем возможностью установить и снять слушателей событий, вызвать слушателей при возникновении события.

Методы:

- `on` - устанавливает обработчик на событие.
- `off` - снимает обработчик с события.
- `emit` - инициализация события.
- `onAll` - подписка на все события.
- `offAll` - сбросить все обработчики событий.
- `trigger` - создаёт функцию-коллбэк, которая при вызове генерирует событие с заданными параметрами.

**Класс Api**
Обеспечивает взаимодействие HTTP-запросов с веб-API - отправляет запросы и обрабатывает ответы. 

Методы: 

- `get` - принимает изменяющеюся часть url-адреса, выполняет GET-запрос по указанному uri и возвращает ответ в виде Promise.
- `post` - принимает изменяющеюся часть url-адреса, данные в виде объекта, выполняет POST-запрос или другой запрос, указанный в параметре method, возвращает ответ в виде Promise.

## Слой данных (model)

**Класс ProductModel**
Класс управляет коллекцией продуктов, предоставляя функциональность для добавления, удаления и получения информации о продуктах.

Методы:

- `getAllProducts(): IProduct[]` — Возвращает массив всех продуктов.
- `getProductById(id: string): IProduct | null` — Возвращает продукт по его ID или null, если продукт не найден.
- `addProduct(product: IProduct): void` — Добавляет новый продукт в коллекцию. Если продукт с таким ID уже существует, выводит предупреждение.
- `removeProduct(id: string): void` — Удаляет продукт из коллекции по его ID. Если продукт не найден, выводит предупреждение.
- `isProductExists(id: string): boolean` — Проверяет, существует ли продукт с указанным ID в коллекции.

**Класс CartModel**
Управляет корзиной покупок, предоставляет методы для добавления, удаления товаров, очистки корзины и расчета общей суммы.

Методы:

- `getCartItems(): IProduct[]` — Возвращает массив товаров, добавленных в корзину.
- `addToCart(productId: string): void` — Добавляет товар в корзину по его ID. Выводит предупреждение, если товар уже добавлен.
- `removeFromCart(productId: string): void` — Удаляет товар из корзины по его ID. Обновляет счетчик товаров.
- `clearCart(): void` — Полностью очищает корзину, удаляя все товары, и обновляет счетчик.
- `calculateTotal(): number` — Возвращает общую сумму товаров в корзине.
- `isProductAdded(productId: string): boolean` — Проверяет, добавлен ли товар в корзину.
- `private updateCartCounter(): void` — Обновляет визуальный счетчик товаров в корзине (используется внутренне).

**Класс OrderModel**
Управляет процессом оформления заказа: установка данных, проверка корректности и подтверждение.

Методы:

- `setDeliveryAddress(address: string): void` — Устанавливает адрес доставки.
- `setPaymentMethod(payment: Payment): void` — Устанавливает способ оплаты.
- `setContactInfo(email: string, phone: string): void` — Устанавливает контактную почту и телефон.
- `setTotal(total: number): void` — Устанавливает общую сумму заказа.
- `setItems(items: IProduct[]): void` — Устанавливает список товаров (только с положительной ценой).
- `validateAddress(): boolean` — Проверяет корректность адреса доставки.
- `validateContactInfo(): boolean` — Проверяет корректность контактных данных.
- `confirmOrder(): boolean` — Подтверждает заказ, если все данные указаны корректно.
- `getOrder(): IOrder` — Возвращает объект с данными заказа. если заказ оформлен успешно.

## Слой представления(view)

**Класс CatalogView**
Отвечает за управление отображением каталога товаров, включая создание карточек и обработку кликов по ним.

Методы:

- `renderCatalog(items: IProduct[]): void` — Отображает каталог товаров, очищает контейнер и создает карточки для каждого товара.
- `setProductClickHandler(handler: (productId: string) => void): void` — Устанавливает обработчик кликов по карточкам товаров.
- `createCardElement(product: IProduct): HTMLElement` — (приватный) Создает и возвращает элемент карточки товара на основе шаблона и данных товара.
- `handleCardClick(event: MouseEvent): void` — (приватный) Обрабатывает клики по карточкам товаров и вызывает зарегистрированный обработчик, передавая productId.

**Класс Modal**
Класс предназначен для управления модальным окном, включая его отображение, скрытие и управление содержимым.

Методы:

- `setContent(content: HTMLElement | string): void` - Устанавливает содержимое модального окна. Может принимать HTML-элемент или строку.
- `getContent(): HTMLElement` - Возвращает HTML-элемент контейнера содержимого модального окна.
- `open(): void` - Открывает модальное окно, предварительно закрыв любое другое активное окно.
- `close(): void` - Закрывает текущее модальное окно.

**Класс CartView**
Отвечает за управление отображением корзины в модальном окне, включая вывод списка товаров, общей суммы и обработку действий пользователя.

Методы:

- `renderCart(items: IProduct[], total: number): void` — Отображает список товаров и общую сумму корзины в модальном окне.
- `updateTotal(total: number): void` — Обновляет общую сумму корзины без перерисовки товаров.
- `setRemoveHandler(handler: (productId: string) => void): void` — Устанавливает обработчик для удаления товаров из корзины.
- `setCheckoutHandler(handler: () => void): void` — Устанавливает обработчик для кнопки оформления заказа.
- `createBasketItem(product: IProduct, index: number): HTMLElement` — (приватный) Создает элемент списка для отображения товара в корзине.

**Класс ProductView**
Класс отвечает за отображение подробной информации о продукте в модальном окне и взаимодействие с корзиной.

Методы:

- `renderProductDetails(product: IProduct): void` - Отображает детали продукта, включая изображение, описание, цену, а также позволяет добавлять продукт в корзину или удалять из нее.

**Класс ContactsFormView**
Класс предназначен для управления отображением и логикой формы ввода контактных данных.

Методы:

- `render(): HTMLElement` — Отображает форму и добавляет обработчики событий.
- `getValues(): { email: string; phone: string }` — Возвращает текущие значения полей email и телефона.
- `attachListeners(): void` — (приватный) Устанавливает обработчики событий на элементы формы.
- `validateInputs(): boolean` — (приватный) Проверяет валидность данных в полях формы.
- `validateEmail(email: string): boolean` — (приватный) Проверяет, содержит ли email символ @.
- `validatePhone(phone: string): boolean` — (приватный) Проверяет, что номер телефона содержит только допустимые символы и имеет длину 11 или больше.
- `onSubmit(): void` — (приватный) Вызывается при отправке формы. Эмитит событие order:confirmOrder, если данные валидны.

**Класс OrderFormView**
Класс отвечает за отображение и обработку формы заказа, включая выбор метода оплаты и ввод адреса доставки.

Методы:

- `render(): HTMLElement` - Отображает форму заказа, добавляет обработчики событий, возвращает элемент формы.
- `getValues(): { payment: Payment; address: string }` - Возвращает текущие значения формы: выбранный метод оплаты и адрес доставки.
- `attachListeners(): void` - (приватный) Добавляет обработчики событий для кнопок выбора оплаты, поля адреса и отправки формы.
- `onSubmit(): void` - (приватный) Проверяет валидность данных и эмиттирует событие order:nextStep для перехода на следующий этап.

**Класс SuccessView**
Этот класс предназначен для отображения модального окна с сообщением о успешном завершении заказа. Используется для информирования пользователя о списании средств и предоставляет возможность закрыть сообщение.

Методы:

- `render(totalSpent: number): void` - Отображает модальное окно с сообщением об успешной оплате.

## Презентер(presenter)

**Класс CatalogPresenter**
Предназначен для управления логикой каталога товаров. Содержит методы для отображения каталога, обработки выбора продукта и отображения деталей продукта.

Методы:

- `initialize(products: IProduct[]): void` — Инициализирует каталог, отображая список продуктов и устанавливая обработчики кликов на карточки товаров.
- `handleOpenProductModal(productId: string): void` — (приватный) Открывает модальное окно с подробной информацией о выбранном продукте. Если продукт не найден, выводит сообщение об ошибке в консоль.

**Класс CartPresenter**
Управляет логикой корзины, взаимодействием с моделью корзины, отображением и событиями.

Методы:

- `initialize(): void` — Настраивает подписки на события и обработчики интерфейса.
- `handleAddToCart(data: { productId: string }): void` — Добавляет товар в корзину.
- `handleRemoveFromCartEvent(data: { productId: string }): void` — Удаляет товар из корзины на основе события.
- `updateCartCounter(): void` — Обновляет количество товаров в корзине на интерфейсе.
- `handleRemoveFromCart(productId: string): void` — Удаляет товар через интерфейс и обновляет корзину.
- `handleProceedToCheckout(): void` — Переходит к процессу оформления заказа.


**Класс CheckoutPresenter**
Отвечает за управление процессом оформления заказа, включая валидацию данных, взаимодействие с сервером, отображение шагов и завершение покупки.

Методы:

- `initialize(): void` — Инициализирует процесс оформления заказа, устанавливая обработчики событий.
- `startCheckout(): void` — Запускает процесс оформления заказа, передавая данные из корзины в модель заказа и открывая первый шаг.
- `handleNextStep(): void` — Переходит к следующему шагу, валидируя данные текущего.
- `handleConfirmOrder(): void` — Подтверждает заказ, отправляет данные на сервер и отображает результат.
- `validateAddress(): boolean` — Проверяет корректность адреса доставки.
- `validateContactInfo(): boolean` — Проверяет корректность контактной информации.